# 乒乓球训练管理系统设计文档

## 1. 引言

### 1.1 编写目的
本文档旨在详细描述乒乓球训练管理系统的设计方案，为开发人员提供技术实现指导，为测试人员提供测试依据，为项目管理人员提供进度控制参考。

### 1.2 项目背景
乒乓球训练管理系统是为乒乓球训练机构开发的一套信息化管理平台，旨在提高训练管理效率，规范管理流程。

### 1.3 系统概述
系统采用前后端分离架构，后端基于Spring Boot框架，前端基于Vue.js框架，通过RESTful API进行数据交互。

## 2. 系统架构设计

### 2.1 总体架构
系统采用前后端分离的MVC架构模式：
- 前端：Vue.js + Element UI
- 后端：Spring Boot + MyBatis-Plus
- 数据库：MySQL 8.0

### 2.2 技术架构图
```
┌─────────────────────────────────────────────────────────────┐
│                    浏览器/移动端                            │
└─────────────────────────┬───────────────────────────────────┘
                          │ HTTP请求
┌─────────────────────────▼───────────────────────────────────┐
│                    Nginx/Web服务器                          │
└─────────────────────────┬───────────────────────────────────┘
                          │ API调用
┌─────────────────────────▼───────────────────────────────────┐
│                      Vue.js前端                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  组件层     │  │  路由层     │  │  状态管理层 │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────┬───────────────────────────────────┘
                          │ RESTful API
┌─────────────────────────▼───────────────────────────────────┐
│                      Spring Boot后端                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  控制层     │  │  服务层     │  │  数据访问层 │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────┬───────────────────────────────────┘
                          │ JDBC
┌─────────────────────────▼───────────────────────────────────┐
│                        MySQL数据库                          │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 架构优势
1. 前后端分离，便于并行开发和维护
2. 微服务架构，易于扩展和部署
3. RESTful API设计，接口清晰规范
4. 统一异常处理，提高系统稳定性

## 3. 数据库设计

### 3.1 数据库逻辑设计

#### 3.1.1 用户表 (user)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | int | PK, Auto Increment | 主键 |
| no | varchar(20) | Unique | 账号 |
| name | varchar(100) | Not Null | 姓名 |
| password | varchar(20) | Not Null | 密码 |
| age | int | | 年龄 |
| sex | int | | 性别 |
| phone | varchar(20) | | 电话 |
| role_id | int | | 角色ID |
| is_valid | varchar(4) | | 是否有效 |
| campus_id | int | | 所属校区ID |
| balance | decimal(10,2) | | 账户余额 |
| super_admin_key | varchar(32) | | 超级管理员密钥 |
| key_created_time | datetime | | 密钥创建时间 |
| key_expired_time | datetime | | 密钥过期时间 |
| device_id | varchar(100) | | 设备标识 |

#### 3.1.2 菜单表 (menu)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | int | PK | 主键 |
| menu_code | varchar(8) | | 菜单编码 |
| menu_name | varchar(16) | | 菜单名称 |
| menu_level | varchar(2) | | 菜单级别 |
| menu_parent_code | varchar(8) | | 父菜单编码 |
| menu_click | varchar(16) | | 点击触发函数 |
| menu_right | varchar(8) | | 权限 |
| menu_component | varchar(200) | | 菜单组件 |
| menu_icon | varchar(100) | | 菜单图标 |

#### 3.1.3 学员表 (student)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | int | PK, Auto Increment | 主键 |
| user_id | int | FK, Unique | 用户ID |
| birth_date | date | | 出生日期 |
| enrollment_date | date | | 入学日期 |
| level | int | | 训练等级 |
| coach_id | int | FK | 教练ID |
| status | int | | 状态 |

#### 3.1.4 训练计划表 (training_plan)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | int | PK, Auto Increment | 主键 |
| name | varchar(100) | Not Null | 计划名称 |
| description | varchar(1000) | | 描述 |
| start_time | datetime | | 开始时间 |
| end_time | datetime | | 结束时间 |
| coach_id | int | FK | 教练ID |
| student_id | int | FK | 学员ID |
| status | int | | 状态 |

#### 3.1.5 训练记录表 (training_record)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | int | PK, Auto Increment | 主键 |
| plan_id | int | FK | 训练计划ID |
| student_id | int | FK | 学员ID |
| content | varchar(1000) | | 训练内容 |
| duration | int | | 训练时长(分钟) |
| create_time | datetime | | 记录时间 |
| feedback | varchar(1000) | | 反馈 |

#### 3.1.6 成绩记录表 (performance_record)
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | int | PK, Auto Increment | 主键 |
| student_id | int | FK | 学员ID |
| event_name | varchar(100) | | 项目名称 |
| score | decimal(10,2) | | 成绩 |
| record_time | datetime | | 记录时间 |
| description | varchar(1000) | | 描述 |

### 3.2 数据库物理设计

#### 3.2.1 索引设计
1. 用户表：在no字段上建立唯一索引
2. 菜单表：在menu_code字段上建立唯一索引
3. 训练记录表：在student_id、create_time字段上建立复合索引

#### 3.2.2 分区设计
对于大数据量的表（如训练记录表、成绩记录表），按时间进行分区，提高查询效率。

## 4. 系统功能模块设计

### 4.1 用户管理模块

#### 4.1.1 功能结构图
```
用户管理
├── 用户注册
├── 用户登录
├── 用户信息维护
├── 密码管理
├── 权限管理
└── 用户状态管理
```

#### 4.1.2 类设计
```java
// 用户实体类
@Entity
@Table(name = "user")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true)
    private String no;
    
    @Column(nullable = false)
    private String name;
    
    @Column(nullable = false)
    private String password;
    
    private Integer age;
    private Integer sex;
    private String phone;
    private Integer roleId;
    private String isValid;
    private Integer campusId;
    private BigDecimal balance;
    
    // getter和setter方法
}

// 用户服务接口
public interface UserService {
    User login(String username, String password);
    User register(User user);
    User findById(Long id);
    List<User> findAll();
    void updateUser(User user);
    void deleteUser(Long id);
    boolean checkPermission(Long userId, String permission);
}
```

### 4.2 菜单管理模块

#### 4.2.1 功能结构图
```
菜单管理
├── 菜单配置
├── 权限分配
├── 菜单展示
└── 菜单状态管理
```

#### 4.2.2 类设计
```java
// 菜单实体类
@Entity
@Table(name = "menu")
public class Menu {
    @Id
    private Long id;
    
    private String menuCode;
    private String menuName;
    private String menuLevel;
    private String menuParentCode;
    private String menuClick;
    private String menuRight;
    private String menuComponent;
    private String menuIcon;
    
    // getter和setter方法
}

// 菜单服务接口
public interface MenuService {
    List<Menu> getMenuByRole(Integer roleId);
    List<Menu> getAllMenus();
    void saveMenu(Menu menu);
    void updateMenu(Menu menu);
    void deleteMenu(Long id);
}
```

### 4.3 训练管理模块

#### 4.3.1 功能结构图
```
训练管理
├── 训练计划制定
├── 训练记录管理
├── 训练效果评估
└── 训练统计分析
```

#### 4.3.2 类设计
```java
// 训练计划实体类
@Entity
@Table(name = "training_plan")
public class TrainingPlan {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String name;
    
    private String description;
    private LocalDateTime startTime;
    private LocalDateTime endTime;
    private Long coachId;
    private Long studentId;
    private Integer status;
    
    // getter和setter方法
}

// 训练记录实体类
@Entity
@Table(name = "training_record")
public class TrainingRecord {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private Long planId;
    private Long studentId;
    private String content;
    private Integer duration;
    private LocalDateTime createTime;
    private String feedback;
    
    // getter和setter方法
}

// 训练服务接口
public interface TrainingService {
    TrainingPlan createPlan(TrainingPlan plan);
    List<TrainingPlan> getPlansByCoach(Long coachId);
    List<TrainingPlan> getPlansByStudent(Long studentId);
    TrainingRecord addRecord(TrainingRecord record);
    List<TrainingRecord> getRecordsByStudent(Long studentId);
    void updatePlan(TrainingPlan plan);
    void deletePlan(Long id);
}
```

### 4.4 场地管理模块

#### 4.4.1 功能结构图
```
场地管理
├── 场地信息维护
├── 场地预约管理
├── 场地使用记录
└── 场地状态管理
```

#### 4.4.2 类设计
```java
// 场地实体类
@Entity
@Table(name = "court")
public class Court {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String name;
    
    private String location;
    private Integer status;
    private String description;
    
    // getter和setter方法
}

// 场地预约实体类
@Entity
@Table(name = "court_reservation")
public class CourtReservation {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private Long courtId;
    private Long userId;
    private LocalDateTime startTime;
    private LocalDateTime endTime;
    private Integer status;
    private LocalDateTime createTime;
    
    // getter和setter方法
}

// 场地服务接口
public interface CourtService {
    Court addCourt(Court court);
    List<Court> getAllCourts();
    Court findById(Long id);
    void updateCourt(Court court);
    void deleteCourt(Long id);
    
    CourtReservation makeReservation(CourtReservation reservation);
    List<CourtReservation> getReservationsByCourt(Long courtId);
    List<CourtReservation> getReservationsByUser(Long userId);
    void cancelReservation(Long id);
}
```

### 4.5 器材管理模块

#### 4.5.1 功能结构图
```
器材管理
├── 器材信息维护
├── 器材借用管理
├── 器材归还管理
├── 库存管理
└── 器材类型管理
```

#### 4.5.2 类设计
```java
// 器材实体类
@Entity
@Table(name = "equipment")
public class Equipment {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String name;
    
    private Long typeId;
    private Integer count;
    private Integer status;
    private String description;
    
    // getter和setter方法
}

// 器材借用实体类
@Entity
@Table(name = "equipment_borrow")
public class EquipmentBorrow {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private Long equipmentId;
    private Long userId;
    private LocalDateTime borrowTime;
    private LocalDateTime returnTime;
    private Integer status;
    
    // getter和setter方法
}

// 器材服务接口
public interface EquipmentService {
    Equipment addEquipment(Equipment equipment);
    List<Equipment> getAllEquipment();
    Equipment findById(Long id);
    void updateEquipment(Equipment equipment);
    void deleteEquipment(Long id);
    
    EquipmentBorrow borrowEquipment(EquipmentBorrow borrow);
    EquipmentBorrow returnEquipment(Long borrowId);
    List<EquipmentBorrow> getBorrowsByUser(Long userId);
    List<EquipmentBorrow> getBorrowsByEquipment(Long equipmentId);
}
```

### 4.6 学员管理模块

#### 4.6.1 功能结构图
```
学员管理
├── 学员信息管理
├── 学员训练档案
├── 学员成绩管理
└── 学员状态管理
```

#### 4.6.2 类设计
```java
// 学员实体类
@Entity
@Table(name = "student")
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true)
    private Long userId;
    
    private LocalDate birthDate;
    private LocalDate enrollmentDate;
    private Integer level;
    private Long coachId;
    private Integer status;
    
    // getter和setter方法
}

// 成绩记录实体类
@Entity
@Table(name = "performance_record")
public class PerformanceRecord {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private Long studentId;
    private String eventName;
    private BigDecimal score;
    private LocalDateTime recordTime;
    private String description;
    
    // getter和setter方法
}

// 学员服务接口
public interface StudentService {
    Student addStudent(Student student);
    Student findByUserId(Long userId);
    List<Student> getAllStudents();
    void updateStudent(Student student);
    void deleteStudent(Long id);
    
    PerformanceRecord addPerformanceRecord(PerformanceRecord record);
    List<PerformanceRecord> getRecordsByStudent(Long studentId);
    List<PerformanceRecord> getRecordsByEvent(String eventName);
}
```

## 5. 接口设计

### 5.1 RESTful API设计原则
1. 使用HTTP动词表示操作类型（GET、POST、PUT、DELETE）
2. 使用名词表示资源
3. 使用HTTP状态码表示操作结果
4. 返回JSON格式数据

### 5.2 主要API接口

#### 5.2.1 用户管理接口
| 接口地址 | 请求方法 | 功能说明 |
|----------|----------|----------|
| /api/users/login | POST | 用户登录 |
| /api/users/register | POST | 用户注册 |
| /api/users/{id} | GET | 获取用户信息 |
| /api/users/{id} | PUT | 更新用户信息 |
| /api/users/{id} | DELETE | 删除用户 |
| /api/users | GET | 获取用户列表 |

#### 5.2.2 菜单管理接口
| 接口地址 | 请求方法 | 功能说明 |
|----------|----------|----------|
| /api/menus/role/{roleId} | GET | 根据角色获取菜单 |
| /api/menus | GET | 获取所有菜单 |
| /api/menus | POST | 创建菜单 |
| /api/menus/{id} | PUT | 更新菜单 |
| /api/menus/{id} | DELETE | 删除菜单 |

#### 5.2.3 训练管理接口
| 接口地址 | 请求方法 | 功能说明 |
|----------|----------|----------|
| /api/training/plans | POST | 创建训练计划 |
| /api/training/plans/coach/{coachId} | GET | 获取教练的训练计划 |
| /api/training/plans/student/{studentId} | GET | 获取学员的训练计划 |
| /api/training/plans/{id} | PUT | 更新训练计划 |
| /api/training/plans/{id} | DELETE | 删除训练计划 |
| /api/training/records | POST | 添加训练记录 |
| /api/training/records/student/{studentId} | GET | 获取学员的训练记录 |

#### 5.2.4 场地管理接口
| 接口地址 | 请求方法 | 功能说明 |
|----------|----------|----------|
| /api/courts | POST | 创建场地 |
| /api/courts | GET | 获取所有场地 |
| /api/courts/{id} | GET | 获取场地详情 |
| /api/courts/{id} | PUT | 更新场地信息 |
| /api/courts/{id} | DELETE | 删除场地 |
| /api/courts/reservations | POST | 场地预约 |
| /api/courts/reservations/court/{courtId} | GET | 获取场地预约记录 |
| /api/courts/reservations/user/{userId} | GET | 获取用户预约记录 |
| /api/courts/reservations/{id} | DELETE | 取消预约 |

#### 5.2.5 器材管理接口
| 接口地址 | 请求方法 | 功能说明 |
|----------|----------|----------|
| /api/equipment | POST | 添加器材 |
| /api/equipment | GET | 获取器材列表 |
| /api/equipment/{id} | GET | 获取器材详情 |
| /api/equipment/{id} | PUT | 更新器材信息 |
| /api/equipment/{id} | DELETE | 删除器材 |
| /api/equipment/borrows | POST | 借用器材 |
| /api/equipment/borrows/{id}/return | PUT | 归还器材 |
| /api/equipment/borrows/user/{userId} | GET | 获取用户借用记录 |
| /api/equipment/borrows/equipment/{equipmentId} | GET | 获取器材借用记录 |

#### 5.2.6 学员管理接口
| 接口地址 | 请求方法 | 功能说明 |
|----------|----------|----------|
| /api/students | POST | 添加学员 |
| /api/students | GET | 获取学员列表 |
| /api/students/user/{userId} | GET | 根据用户ID获取学员信息 |
| /api/students/{id} | PUT | 更新学员信息 |
| /api/students/{id} | DELETE | 删除学员 |
| /api/students/performance | POST | 添加成绩记录 |
| /api/students/performance/student/{studentId} | GET | 获取学员成绩记录 |
| /api/students/performance/event/{eventName} | GET | 根据项目获取成绩记录 |

## 6. 前端设计

### 6.1 前端架构
前端采用Vue.js框架，使用Element UI组件库，通过Vue Router实现路由管理，通过Vuex实现状态管理。

### 6.2 主要页面设计

#### 6.2.1 登录页面
- 用户名输入框
- 密码输入框
- 登录按钮
- 注册链接

#### 6.2.2 首页
- 顶部导航栏（包含用户信息、退出登录等）
- 左侧菜单栏（根据用户权限动态加载）
- 主内容区域

#### 6.2.3 用户管理页面
- 用户列表展示（支持分页、搜索）
- 用户信息编辑表单
- 用户删除确认对话框

#### 6.2.4 训练管理页面
- 训练计划列表
- 训练计划详情
- 训练记录录入表单
- 训练统计图表

#### 6.2.5 场地管理页面
- 场地列表和状态展示
- 场地预约日历视图
- 预约记录管理

#### 6.2.6 器材管理页面
- 器材库存列表
- 器材借用/归还操作
- 器材类型管理

#### 6.2.7 学员管理页面
- 学员信息档案
- 学员成绩记录
- 学员训练进度跟踪

### 6.3 组件设计

#### 6.3.1 公共组件
1. Header组件：顶部导航栏
2. Sidebar组件：侧边栏菜单
3. Breadcrumb组件：面包屑导航
4. Pagination组件：分页组件
5. Modal组件：模态框组件

#### 6.3.2 业务组件
1. UserForm组件：用户信息表单
2. TrainingPlanForm组件：训练计划表单
3. CourtReservation组件：场地预约组件
4. EquipmentBorrow组件：器材借用组件
5. PerformanceChart组件：成绩图表组件

## 7. 安全设计

### 7.1 认证授权设计
1. 基于JWT的Token认证机制
2. 用户登录后生成Token，后续请求携带Token
3. 基于角色的访问控制（RBAC）
4. 接口权限验证

### 7.2 数据安全设计
1. 敏感数据加密存储（如用户密码）
2. 数据传输使用HTTPS协议
3. SQL注入防护
4. XSS攻击防护

### 7.3 应用安全设计
1. 登录失败次数限制
2. 密码强度验证
3. 会话超时管理
4. 操作日志记录

## 8. 性能优化设计

### 8.1 数据库优化
1. 合理设计索引
2. SQL语句优化
3. 数据库连接池配置
4. 查询结果缓存

### 8.2 前端优化
1. 图片压缩和懒加载
2. 组件按需加载
3. HTTP请求合并
4. 浏览器缓存利用

### 8.3 后端优化
1. 接口响应数据压缩
2. 异步处理耗时操作
3. 缓存热点数据
4. 代码性能优化

## 9. 部署设计

### 9.1 部署架构
```
┌─────────────────────────────────────────────────────────────┐
│                    负载均衡器(Nginx)                        │
└─────────────────────────┬───────────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
┌───────▼───────┐ ┌───────▼───────┐ ┌───────▼───────┐
│  应用服务器1  │ │  应用服务器2  │ │  应用服务器N  │
│ (Spring Boot) │ │ (Spring Boot) │ │ (Spring Boot) │
└───────┬───────┘ └───────┬───────┘ └───────┬───────┘
        │                 │                 │
        └─────────────────┼─────────────────┘
                          │
┌─────────────────────────▼───────────────────────────────────┐
│                    MySQL主从复制集群                        │
└─────────────────────────────────────────────────────────────┘
```

### 9.2 部署环境
1. 操作系统：Linux (CentOS 7.x或Ubuntu 18.04+)
2. Web服务器：Nginx 1.18+
3. 应用服务器：Spring Boot内嵌Tomcat
4. 数据库：MySQL 8.0主从复制集群
5. 缓存：Redis 6.x
6. 消息队列：RabbitMQ 3.8+

### 9.3 部署流程
1. 代码打包：使用Maven将后端代码打包为jar文件
2. 前端构建：使用npm将Vue项目构建为静态文件
3. 环境配置：配置数据库连接、Redis连接等
4. 应用部署：将jar文件和静态文件部署到服务器
5. 服务启动：启动Spring Boot应用和Nginx
6. 健康检查：验证各服务是否正常运行

## 10. 监控与日志设计

### 10.1 系统监控
1. 应用性能监控（APM）：使用Pinpoint或SkyWalking
2. 服务器监控：CPU、内存、磁盘使用率
3. 数据库监控：连接数、慢查询等
4. 接口监控：响应时间、错误率等

### 10.2 日志设计
1. 日志级别：DEBUG、INFO、WARN、ERROR
2. 日志内容：时间戳、日志级别、类名、方法名、日志信息
3. 日志存储：按天分割日志文件
4. 日志分析：使用ELK（Elasticsearch、Logstash、Kibana）进行日志分析

## 11. 测试设计

### 11.1 测试策略
1. 单元测试：使用JUnit测试业务逻辑
2. 接口测试：使用Postman或JMeter测试API接口
3. 集成测试：测试模块间的集成
4. 性能测试：使用JMeter进行压力测试
5. 安全测试：测试系统的安全性

### 11.2 测试环境
1. 开发环境：开发人员本地环境
2. 测试环境：与生产环境配置一致的测试环境
3. 预生产环境：与生产环境完全一致的环境

## 12. 维护设计

### 12.1 版本管理
1. 使用Git进行版本控制
2. 采用Git Flow分支管理策略
3. 版本号遵循语义化版本规范

### 12.2 数据备份
1. 定时备份数据库
2. 备份文件加密存储
3. 定期验证备份文件完整性

### 12.3 故障处理
1. 建立故障响应机制
2. 制定故障恢复预案
3. 定期进行故障演练